<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MRIQC Report Viewer</title>
    <script>
        async function loadOptions(file, dropdownId) {
            const response = await fetch(file);
            const text = await response.text();
            const lines = text.split('\n').filter(line => line.trim() !== '');
            const dropdown = document.getElementById(dropdownId);
            
            lines.forEach(line => {
                const match = line.match(/sub-(\w+)_ses-\d+_task-(\w+)_run-1_bold.html/);
                if (match) {
                    const subjectId = match[1];
                    const taskName = match[2];
                    const displayText = `${subjectId}_${taskName}`;
                    
                    const option = document.createElement("option");
                    option.value = line;
                    option.textContent = displayText;
                    dropdown.appendChild(option);
                }
            });
        }
        
        function goToReport() {
            const failed_selection = document.getElementById("mriqc_failed").value;
            const passed_selection = document.getElementById("mriqc_passed").value;
            
            if (failed_selection && passed_selection){
                alert("Please select only either from mriqc_passed or mriqc_failed.");
                return;
            }

            if (failed_selection) {
                window.location.href = `ds004636/derivatives/mriqc_failed/${failed_selection}`;
            } else if (passed_selection) {
                window.location.href = `ds004636/derivatives/mriqc_passed/${passed_selection}`;
            } else {
                alert("Please select a report.");
            }
        }
        
        document.addEventListener("DOMContentLoaded", function() {
            loadOptions("mriqc_failed/mriqc_failed.txt", " mriqc_failed");
            loadOptions("mriqc_passed/mriqc_passed.txt", "mriqc_passed");
        });
    </script>
</head>
<body>
    <h1>MRIQC Report Viewer</h1>
    <p>Select one report at a time to visualize. </p>
    <label for="mriqc_failed">Failed Reports:</label>
    <select id="mriqc_failed">
        <option value="">Select a failed report</option>
    </select>
    
    <label for="mriqc_passed">Included Reports:</label>
    <select id="mriqc_passed">
        <option value="">Select an included report</option>
    </select>
    
    <button onclick="goToReport()">Go!</button>
</body>
</html>
